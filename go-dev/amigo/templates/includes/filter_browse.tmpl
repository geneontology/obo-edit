[% INCLUDE filters.tmpl %]
<dl>
	<dt id="filterToggle" class="toggle">Filter tree view <a href="http://www.geneontology.org/amigo/help-filter_browse.shtml" class="help-link"><img src="[% image_dir %]/help.png" alt="help!"></a></dt>


	<dd id="filterDiv">
[%# USE Dumper; '<pre>'; Dumper.dump(tree); '</pre>' %]
		<form action="[% cgi %].cgi">
			[% FOREACH p IN tree.keys;
					IF tree.$p.size > 0; %]
			<input type="hidden" name="[% p %]" value="[% tree.$p.join(',') %]">
			[% END; END %]
					
			<fieldset class="floatL block"><legend>Filter by ontology</legend>
			[% opt_name = 'ont';
				INCLUDE options_select.tmpl %]
			</fieldset>
			[% all_filters = ['evcode', 'taxid', 'gptype', 'qual', 'assby'];
				active = [];
				FOREACH f = all_filters;
					IF filterdata.$f;
						active.push(f);
				END; END;

				IF filterdata.keys.size > 0 %]
				<fieldset class="floatL block">
					<legend>Filter Gene Product Counts</legend>
				[% IF filterdata.speciesdb;
						opt_name = 'speciesdb';
						INCLUDE options_select.tmpl;
					END;
					IF active.size > 0; %]
					<ul class="floatL">
					[% FOREACH opt_name = active;
							title = filterdata.$opt_name.title;
							IF opt_name != 'taxid'; title = title _ 's'; END; %]
					<li>[% INCLUDE options_checkbox_all.tmpl %]</li>
					[% END %]
					</ul>
				[% END %]
				</fieldset>
			[% END %]
			<fieldset class="floatL block">
				<legend>View Options</legend>
			[% opt_name = 'tree_view';
				option = extra_filter.$opt_name.data %]
				<p>[% extra_filter.$opt_name.title %] 
				[% INCLUDE options_radio.tmpl %]
				</p>
			</fieldset>
				<input type="hidden" name="session_id" value="[% session_id %]">
				<input type="hidden" name="action" value="filter">
				<input class="button" type="submit" value="Set filters"> 
		</form>
		<form action="[% cgi %].cgi">
			[% FOREACH p IN tree.keys;
					IF tree.$p.size > 0; %]
			<input type="hidden" name="[% p %]" value="[% tree.$p.join(',') %]">
			[% END; END %]
				<input type="hidden" name="session_id" value="[% session_id %]">
				<input type="hidden" name="action" value="reset-filters">
				<input class="button" type="submit" value="Remove all filters"> 
		</form>
<hr class="clearL">
	</dd>
</dl>
