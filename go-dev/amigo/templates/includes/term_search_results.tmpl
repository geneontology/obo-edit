[% IF n_pages > 1;
		INCLUDE paging.tmpl;
	END;

	sort_link = "search.cgi?" _ url_string _ "&amp;action=sort&amp;session_id=" _ session_id;

	IF page_size && page_size == 'all';
		sort_link = sort_link _ "&amp;page_size=all";
	ELSE;
		sort_link = sort_link _ "&amp;page=1";
	END %]
<form action="term-select.cgi" method="POST">
<input type="hidden" name="session_id" value="[% session_id %]">
<table id="results" summary="Term search results for [% querytext %]">
<thead>
[%# pos = 'top';
	colspan = 2;
	PROCESS options_term_table.tmpl %]
<tr>
	<th>
	[% IF termsort == 'rel' %]
		<em class="sortedBy">rel</em>
	[% ELSE %]
		<a href="[% sort_link %]&amp;termsort=rel" title="Sort results by relevance">rel</a></th>
	[% END %]
	<th>
		[% IF termsort == 'acc' %]
			<em class="sortedBy">GO ID</em>
		[% ELSE %]
			<a href="[% sort_link %]&amp;termsort=acc" title="Sort results by GO ID">GO ID</a>
		[% END %], 
		[% IF termsort == 'name' %]
			<em class="sortedBy">Term</em>
		[% ELSE %]
			<a href="[% sort_link %]&amp;termsort=name" title="Sort results by term name">Term</a>
		[% END %]
	</th>
	<th>
		[% IF termsort == 'term_type' %]
			<em class="sortedBy">Ontology</em>
		[% ELSE %]
			<a href="[% sort_link %]&amp;termsort=term_type" title="Sort results by ontology name">Ontology</a>
		[% END %]
	</th>
	</tr>
	</thead>
	<tbody>
[% counter = 1;
	FOREACH term = data;
		IF term.is_obsolete %]
			<tr class="obsolete term" id="t-[% counter %]">
	[% ELSIF counter % 2 == 0 %]
			<tr class="even_row term" id="t-[% counter %]">
	[% ELSE %]
			<tr class="term" id="t-[% counter %]">
	[% END %]
		<td>[% IF term.is_obsolete == 0 %]<input class="cbox" type="checkbox" id="[% term.acc %]" value="[% term.acc %]" name="item">[% END %]</td>
		<td>
		[%# USE Dumper; '<pre>'; Dumper.dump(term); '</pre>' %]
			
			<label for="[% term.acc %]" class="acc">[% search.hilite(term.acc, 1) %][%# FILTER $Hilite; term.acc ; END %]</label> : <a href="term-details.cgi?term=[% term.acc %]&amp;session_id=[% session_id %]" title="View details of [% term.name %]" class="name">[% search.hilite(term.name, 1) %]</a>
		[% IF show_gp_options && !term.is_obsolete && term.is_ontology_term;
				gp_assoc_text = 'view gene products';
				IF show_gp_counts;
					gp_assoc_text = term.n_deep_products _ ' gene product';
					IF term.n_deep_products != 1;
						gp_assoc_text = gp_assoc_text _ 's';
				END; END %]
		 <a href="term-assoc.cgi?term=[% term.acc %]&amp;session_id=[% session_id %]" title="View gene products associated with this term" class="assoc-link">[[% gp_assoc_text %]]</a>
		 <a href="browse.cgi?action=set-tree&amp;term=[% term.acc %]&amp;session_id=[% session_id %]" title="View term in the tree" class="assoc-link">[view in tree]</a>
		[% END;
			IF term.definition %]
				<p id="def-[% counter %]"[% IF term.source != 'definition'; ' class="toggleable def"'; END %]>
				[% term.definition %]
				[% IF term.source == 'xref';
						def_xref_matches = term.get_match_list('def_xref', termsort);
						IF def_xref_matches %]
				&nbsp;[ <span class="dbxref">[% def_xref_matches.join("</span>, <span class="dbxref">") %]</span> ]
				[% END; END %]
				</p>
		[% END;

		#	IF term.source == 'term_synonym';
			IF term.source.term_synonym;
				matches = term.get_match_list('term_synonym', termsort);
				IF matches;
					#'<pre>'; Dumper.dump(matches); '</pre>';
					IF matches.size == 1 %]
					<p>Query matches synonym <span class="syn">[% matches.0.name %]</span> [[% matches.0.type %] synonym]</p>
				[% ELSE;
						first = matches.shift;
						last = matches.pop %]
				<ul id="syns-[% counter %]" class="inline">
					<li>Query matches synonyms </li>
					<li class="syn">[% first.name %] [[% first.type %] synonym],</li>
					[% FOREACH syn = matches %]
					 <li class="toggleable syn">[% syn.name %] [[% syn.type %]],</li>
					[% END %]
					 <li class="toggleable syn">[% last.name %] [[% last.type %]]</li>
					</ul>
		[% END; END; END;

		#	IF term.source == 'subset';
			IF term.source.subset;
				subset_matches = term.get_match_list('subset', termsort);
				IF subset_matches;
					IF subset_matches.size == 1 %]
					<p>Query matches subset [% subset_matches.0.name %] [[% subset_matches.0.acc %]]</p>
				[% ELSE;
						first = subset_matches.shift;
						last = subset_matches.pop %]
				<ul id="subsets-[% counter %]" class="inline">
					<li>Query matches subsets </li>
					<li class="syn">[% first.name %] [[% first.acc %]],</li>
					[% FOREACH sub = matches %]
					 <li class="toggleable">[% sub.name %] [[% sub.acc %]],</li>
					[% END %]
					 <li class="toggleable">[% last.name %] [[% last.acc %]]</li>
					</ul>
		[% END; END; END;

		#	IF term.source == 'xref';
			IF term.source.xref;
				xref_matches = term.get_match_list('xref', termsort);
				IF xref_matches;
				#	USE Dumper; '<pre>'; Dumper.dump(xref_matches); '</pre>';
					IF xref_matches.size == 1 %]
					<p>Query matches cross-reference <span class="dbxref">[% xref_matches.0 %]</span></p>
				[% ELSE %]
					<ul id="dbxrefs-[% counter %]" class="dbxreflist inline">
					<li>Query matches cross-references </li><li class="dbxref">[% xref_matches.join(',</li> <li class="toggleable dbxref">') %]</li>
				</ul>
		[% END; END; END;

			IF term.comment;
				comment = term.comment;
				IF term.is_obsolete;
					comment = munger.markup_search_comment(session_id,term.comment);
				END; %]
			<p class="comment">Comment: 
			[% comment %]
				</p>
		[% END %]
			<p>best match: 
			[% FOREACH t = term.source.keys;
					t _ ', ' _ term.source.$t _ '; ';
				END; %]</p>
			</td> 
			<td>
				<a href="http://www.geneontology.org/GO.doc.shtml#[% term.type %]" title="[% term.type.replace('_', ' ') %] documentation" class="ont">[% term.type.replace('_', ' ') %]</a>
			</td>
		</tr>
[% counter = counter + 1; END %]
	</tbody>
	<tfoot>
	<tr>
	<td></td>
	<td colspan="2">
	[% INCLUDE options_term_table.tmpl %]
	</td>
	</tr>
	</tfoot>
	</table>
</form>

[% IF n_pages > 1;
		INCLUDE paging.tmpl;
	END %]
